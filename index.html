<head>
	<script src="JsonToControl.js"></script>
	<style type="text/css">
	div {
		margin: 10px;
	}
	#root {
		background-color: gray;
	}
	.sub {
		background-color: orange;
	}
	.subTable { 
		background-color: yellow;
	}
	</style>
	<script type="text/javascript">

	function onControlToJson () {
		var rootNode = document.getElementById("root");
		if (!rootNode) {
			console.log("onControlToJson root node is null");
			return;
		};

		document.getElementById("textarea").value = JSON.stringify(convertDivToJson(document.getElementById("root")));
	}

	function getColorByDepth (depth) {
		var alpha = 255 - (depth % 5) * 20;

		return "rgb(" + alpha + "," + alpha + "," + alpha + ")";
	}

	function onJsonToControl () {

		var rootNode = document.getElementById("root");
		if (rootNode) {
			rootNode.parentNode.removeChild(rootNode);
		};

		var rootDiv = createDivFromJsonObject(JSON.parse(document.getElementById("textarea").value));
		rootDiv.id = "root";
		document.body.appendChild(rootDiv);

		// change div background color
		var divNodes = document.getElementsByTagName("div");
		for (var i = 0; i < divNodes.length; ++i) {

			var divDepth = 0;
			var divNode = divNodes[i];
			var parentDiv = divNode;

			while (parentDiv) {
				if (parentDiv == document.body) {
					break;
				};

				parentDiv = parentDiv.parentNode;
				divDepth++;
			}

			divNode.style.backgroundColor = getColorByDepth(divDepth);
		}
	}

	function onClearControl () {
		
		var rootNode = document.getElementById("root");
		if (rootNode) {
			rootNode.parentNode.removeChild(rootNode);
		};
	}
	</script>
</head>
<body>
	<textarea id="textarea" cols=100 rows=10>{"a":1, "str":"str", "check":true, "sub":{"subText":"subText"}, "subTable":[{"sub1":"sub1"}, {"sub2":"sub2"}]}</textarea>
	<br/>
	<button onclick="onJsonToControl()">Json -> Control</button>
	<button onclick="onControlToJson()">Control -> Json</button>
	<button onclick="onClearControl()">clear</button>
</body>